<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í° ë°°ê²½í™”ë©´ V2 (ë‹¬ë ¥ ì¶”ê°€)</title>
    <style>
        :root { --bg-color: #1e1e1e; --text-color: #f0f0f0; --accent-color: #007aff; --input-bg: #2c2c2c; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        h1 { margin-bottom: 20px; font-size: 1.5rem; }
        .controls { background: var(--input-bg); padding: 20px; border-radius: 12px; width: 100%; max-width: 400px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); margin-bottom: 20px; }
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; color: #aaa; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #3a3a3a; color: white; box-sizing: border-box; font-family: inherit; }
        textarea { resize: vertical; height: 60px; }
        button { width: 100%; padding: 12px; background-color: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background 0.2s; margin-top: 10px; }
        button:hover { background-color: #005bb5; }
        canvas { max-width: 100%; height: auto; border: 2px solid #444; border-radius: 12px; margin-top: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .download-link { display: block; margin-top: 15px; text-align: center; color: var(--accent-color); text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <h1>ğŸ“… ë°°ê²½í™”ë©´ ë©”ì´ì»¤ V2</h1>

    <div class="controls">
        <div class="control-group">
            <label>1. ì´ë¯¸ì§€ ì„ íƒ</label>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <div class="control-group">
            <label>2. ê¸°ì¢… ì„ íƒ</label>
            <select id="resolutionSelect">
                <option value="1290x2796">iPhone 16/15/14 Pro Max</option>
                <option value="1179x2556">iPhone 16/15/14 Pro</option>
                <option value="1170x2532">iPhone 14/13/12</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
            </select>
        </div>

        <div class="control-group">
            <label>3. ì—¬ë°± ìŠ¤íƒ€ì¼</label>
            <select id="bgStyle" onchange="processImage()">
                <option value="color">ë‹¨ìƒ‰ (Color)</option>
                <option value="blur">ë¸”ëŸ¬ (Blur)</option>
            </select>
            <input type="color" id="bgColor" value="#000000" style="margin-top:5px;" onchange="processImage()">
        </div>

        <hr style="border: 0; border-top: 1px solid #444; margin: 15px 0;">

        <div class="control-group">
            <label>4. í…ìŠ¤íŠ¸ / ë‹¬ë ¥ ì¶”ê°€</label>
            <select id="overlayType" onchange="processImage()">
                <option value="none">ì—†ìŒ</option>
                <option value="calendar">ì´ë²ˆ ë‹¬ ë‹¬ë ¥ (ìë™)</option>
                <option value="text">ì»¤ìŠ¤í…€ ë¬¸êµ¬</option>
            </select>
        </div>

        <div class="control-group" id="textInputGroup" style="display:none;">
            <input type="text" id="customText" placeholder="ì—¬ê¸°ì— ë¬¸êµ¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" oninput="processImage()">
        </div>

        <div class="control-group">
            <label>í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
            <input type="color" id="textColor" value="#ffffff" onchange="processImage()">
        </div>
        
        <div class="control-group">
            <label>ìœ„ì¹˜ ì¡°ì • (ìƒë‹¨/ì¤‘ë‹¨/í•˜ë‹¨)</label>
            <input type="range" id="yPos" min="10" max="90" value="80" oninput="processImage()">
        </div>

        <a id="downloadLink" class="download-link" style="display: none;">ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (í´ë¦­)</a>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const imageInput = document.getElementById('imageInput');
        const resolutionSelect = document.getElementById('resolutionSelect');
        const bgStyle = document.getElementById('bgStyle');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const downloadLink = document.getElementById('downloadLink');

        let originalImage = new Image();
        let isImageLoaded = false;

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                originalImage = new Image();
                originalImage.onload = () => { isImageLoaded = true; processImage(); };
                originalImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });

        resolutionSelect.addEventListener('change', processImage);

        function getTargetSize() {
            if (resolutionSelect.value === 'custom') return { w: 1290, h: 2796 }; 
            const [w, h] = resolutionSelect.value.split('x').map(Number);
            return { w, h };
        }

        function processImage() {
            if (!isImageLoaded) return;

            const target = getTargetSize();
            canvas.width = target.w;
            canvas.height = target.h;

            // 1. ë°°ê²½ ê·¸ë¦¬ê¸°
            if (bgStyle.value === 'color') {
                ctx.fillStyle = document.getElementById('bgColor').value;
                ctx.fillRect(0, 0, target.w, target.h);
            } else {
                // ë¸”ëŸ¬ ì²˜ë¦¬
                ctx.save();
                const scale = Math.max(target.w / originalImage.width, target.h / originalImage.height);
                const x = (target.w / 2) - (originalImage.width / 2) * scale;
                const y = (target.h / 2) - (originalImage.height / 2) * scale;
                ctx.filter = 'blur(50px)';
                ctx.drawImage(originalImage, x - 20, y - 20, originalImage.width * scale + 40, originalImage.height * scale + 40);
                ctx.restore();
                ctx.fillStyle = "rgba(0,0,0,0.4)"; // ê°€ë…ì„±ì„ ìœ„í•´ ì–´ë‘¡ê²Œ
                ctx.fillRect(0, 0, target.w, target.h);
            }

            // 2. ë©”ì¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° (Fit)
            const scale = Math.min(target.w / originalImage.width, target.h / originalImage.height);
            const drawW = originalImage.width * scale;
            const drawH = originalImage.height * scale;
            const drawX = (target.w - drawW) / 2;
            const drawY = (target.h - drawH) / 2; // ì¤‘ì•™ ì •ë ¬
            
            // ì´ë¯¸ì§€ ìœ„ì¹˜ë¥¼ ì‚´ì§ ìœ„ë¡œ ì˜¬ë¦¬ê³  ì‹¶ìœ¼ë©´ drawY - 100 ë“±ì„ í•  ìˆ˜ ìˆìŒ
            ctx.drawImage(originalImage, drawX, drawY, drawW, drawH);

            // 3. ì˜¤ë²„ë ˆì´ (ë‹¬ë ¥/í…ìŠ¤íŠ¸) ê·¸ë¦¬ê¸°
            drawOverlay(target.w, target.h);

            // ë‹¤ìš´ë¡œë“œ ë§í¬ ê°±ì‹ 
            downloadLink.href = canvas.toDataURL('image/png');
            downloadLink.style.display = 'block';
            downloadLink.innerText = "â¬‡ï¸ ì™„ì„±ëœ ë°°ê²½í™”ë©´ ë‹¤ìš´ë¡œë“œ";
        }

        function drawOverlay(w, h) {
            const type = document.getElementById('overlayType').value;
            const color = document.getElementById('textColor').value;
            const yPercent = document.getElementById('yPos').value;
            const y = h * (yPercent / 100);

            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            if (type === 'none') return;

            if (type === 'text') {
                // ì‚¬ìš©ì í…ìŠ¤íŠ¸
                const text = document.getElementById('textInputGroup').querySelector('input').value;
                document.getElementById('textInputGroup').style.display = 'block';
                
                ctx.font = 'bold 80px -apple-system, sans-serif';
                ctx.fillText(text, w / 2, y);
            } 
            else if (type === 'calendar') {
                // ë‹¬ë ¥
                document.getElementById('textInputGroup').style.display = 'none';
                drawCalendar(w, y, color);
            } else {
                 document.getElementById('textInputGroup').style.display = 'none';
            }
        }

        function drawCalendar(w, centerY, color) {
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth(); // 0-11
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            // ì›”/ë…„ í‘œì‹œ
            ctx.font = 'bold 60px -apple-system, sans-serif';
            ctx.fillText(`${monthNames[month]} ${year}`, w / 2, centerY - 120);

            // ë‹¬ë ¥ ìˆ«ì ë¡œì§
            const firstDay = new Date(year, month, 1).getDay(); // 0(Sun) - 6(Sat)
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            ctx.font = '40px monospace';
            const startX = w / 2 - 350; // ëŒ€ëµì ì¸ ì¤‘ì•™ ì •ë ¬ ì‹œì‘ì 
            const cellW = 100;
            const cellH = 60;
            
            // ìš”ì¼ í—¤ë”
            const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            days.forEach((d, i) => {
                ctx.fillText(d, startX + (i * cellW), centerY - 40);
            });

            // ë‚ ì§œ ê·¸ë¦¬ê¸°
            let currentX = startX + (firstDay * cellW);
            let currentY = centerY + 30;
            
            for (let d = 1; d <= lastDate; d++) {
                ctx.fillText(d.toString(), currentX, currentY);
                currentX += cellW;
                if ((firstDay + d) % 7 === 0) { // í† ìš”ì¼ ì§€ë‚˜ë©´ ì¤„ë°”ê¿ˆ
                    currentX = startX;
                    currentY += cellH;
                }
            }
        }
    </script>
</body>
</html>